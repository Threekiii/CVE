# CVE-2024-6387：OpenSSH Server 远程代码执行漏

## 0x01   漏洞简述

OpenSSH 是一套用于安全网络通信的工具，提供了包括远程登录、远程执行命令、文件传输等功能

2024 年 7 月 1 日，OpenSSH 官方发布安全通告，披露 CVE-2024-6387 OpenSSH Server 远程代码执行漏洞。 漏洞成因为条件竞争，因此若要成功利用该漏洞，需要经过多次尝试，并需要绕过相关系统保护措施（如 ASLR），在实际网络环境下利用难度较大，目前仅有针对 32 位机器的利用方案。

同时基于代码引入时间、系统保护措施、系统安装 OpenSSH 版本等，目前已知 CentOS 7/8、RedHat 6/7/8、Debian 11 等系统默认安装的 OpenSSH Server、Windows 操作系统上的 OpenSSH Server 等均不受该漏洞影响。

OpenSSH 官方及各操作系统发行方已发布安全更新，建议相关受影响客户进行更新升级。

影响范围：

```
8.5p1 <= OpenSSH < 9.8p1
```

## 0x02   风险等级

| 评定方式  | 等级  |
| ----- | --- |
| 威胁等级  | 高危  |
| 影响面   | 广泛  |
| 攻击者价值 | 高   |
| 利用难度  | 高   |
| 评分    | 7.8 |

## 0x03   漏洞详情

### 披露时间

2024-07-01

### 参考链接

- https://www.qualys.com/2024/07/01/cve-2024-6387/regresshion.txt
- http://www.openwall.com/lists/oss-security/2024/07/01/12
- http://www.openwall.com/lists/oss-security/2024/07/01/13
- http://www.openwall.com/lists/oss-security/2024/07/02/1
- http://www.openwall.com/lists/oss-security/2024/07/03/1
- http://www.openwall.com/lists/oss-security/2024/07/03/11
- http://www.openwall.com/lists/oss-security/2024/07/03/2
- http://www.openwall.com/lists/oss-security/2024/07/03/3
- http://www.openwall.com/lists/oss-security/2024/07/03/4
- http://www.openwall.com/lists/oss-security/2024/07/03/5
- http://www.openwall.com/lists/oss-security/2024/07/04/1
- https://access.redhat.com/errata/RHSA-2024:4312
- https://access.redhat.com/security/cve/CVE-2024-6387
- https://archlinux.org/news/the-sshd-service-needs-to-be-restarted-after-upgrading-to-openssh-98p1/
- https://arstechnica.com/security/2024/07/regresshion-vulnerability-in-openssh-gives-attackers-root-on-linux/
- https://blog.qualys.com/vulnerabilities-threat-research/2024/07/01/regresshion-remote-unauthenticated-code-execution-vulnerability-in-openssh-server
- https://bugzilla.redhat.com/show_bug.cgi?id=2294604
- https://explore.alas.aws.amazon.com/CVE-2024-6387.html
- https://ftp.netbsd.org/pub/NetBSD/security/advisories/NetBSD-SA2024-002.txt.asc
- https://github.com/AlmaLinux/updates/issues/629
- https://github.com/Azure/AKS/issues/4379
- https://github.com/microsoft/azurelinux/issues/9555
- https://github.com/oracle/oracle-linux/issues/149
- https://github.com/PowerShell/Win32-OpenSSH/discussions/2248
- https://github.com/PowerShell/Win32-OpenSSH/issues/2249
- https://github.com/rapier1/hpn-ssh/issues/87
- https://github.com/zgzhang/cve-2024-6387-poc
- https://lists.mindrot.org/pipermail/openssh-unix-announce/2024-July/000158.html
- https://lists.mindrot.org/pipermail/openssh-unix-dev/2024-July/041431.html
- https://news.ycombinator.com/item?id=40843778
- https://psirt.global.sonicwall.com/vuln-detail/SNWLID-2024-0010
- https://security-tracker.debian.org/tracker/CVE-2024-6387
- https://security.netapp.com/advisory/ntap-20240701-0001/
- https://stackdiary.com/openssh-race-condition-in-sshd-allows-remote-code-execution/
- https://ubuntu.com/security/CVE-2024-6387
- https://ubuntu.com/security/notices/USN-6859-1
- https://www.freebsd.org/security/advisories/FreeBSD-SA-24:04.openssh.asc
- https://www.openssh.com/txt/release-9.8
- https://www.qualys.com/2024/07/01/cve-2024-6387/regresshion.txt
- https://www.suse.com/security/cve/CVE-2024-6387.html
- https://www.theregister.com/2024/07/01/regresshion_openssh/

## 0x04   修复建议

### 通用修补建议

1、升级 OpenSSH 至安全版本 9.8 及其以上，或者各发行版本的安全修复版本。

2、若暂无法升级，建议使用安全组设置 OpenSSH 端口仅对可信地址开放。

3、应用漏洞暂只支持获取 openssh 自身版本，若您确定已为各发行版本安全修复版本，可予忽略。
