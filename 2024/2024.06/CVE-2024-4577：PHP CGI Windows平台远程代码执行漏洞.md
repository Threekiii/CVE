# CVE-2024-4577：PHP CGI Windows 平台远程代码执行漏洞

## 0x01   漏洞简述

PHP 在设计时忽略 Windows 中对字符转换的 Best-Fit 特性，当 PHP 运行在 Window 平台且使用了如下语系（简体中文 936/繁体中文 950/日文 932 等）时，攻击者可构造恶意请求绕过 CVE-2012-1823 保护，从而可在无需登陆的情况下执行任意 PHP 代码。

2024 年 6 月 6 日，PHP 官方发布新版本正式修复该漏洞。

影响范围：

```
PHP 8.3 < 8.3.8
PHP 8.2 < 8.2.20
PHP 8.1 < 8.1.29
```

## 0x02   风险等级

| 评定方式  | 等级  |
| ----- | --- |
| 威胁等级  | 严重  |
| 影响面   | 广泛  |
| 攻击者价值 | 高   |
| 利用难度  | 低   |
| 评分    | 9.5 |

## 0x03   漏洞详情

### 披露时间

2024-06-07

### 参考链接

- http://www.openwall.com/lists/oss-security/2024/06/07/1
- https://arstechnica.com/security/2024/06/php-vulnerability-allows-attackers-t...
- https://avd.aliyun.com/detail/AVD-2024-4577
- https://blog.orange.tw/2024/06/cve-2024-4577-yet-another-php-rce.html
- https://cert.be/en/advisory/warning-php-remote-code-execution-patch-immediately
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-4577
- https://devco.re/blog/2024/06/06/security-alert-cve-2024-4577-php-cgi-argumen...
- https://github.com/11whoami99/CVE-2024-4577
- https://github.com/php/php-src/security/advisories/GHSA-3qgc-jrrr-25jv
- https://github.com/rapid7/metasploit-framework/pull/19247
- https://github.com/watchtowrlabs/CVE-2024-4577
- https://github.com/xcanwin/CVE-2024-4577-PHP-RCE
- https://isc.sans.edu/diary/30994
- https://labs.watchtowr.com/no-way-php-strikes-again-cve-2024-4577/
- https://www.imperva.com/blog/imperva-protects-against-critical-php-vulnerabil...
- https://www.php.net/ChangeLog-8.php#8.1.29
- https://www.php.net/ChangeLog-8.php#8.2.20
- https://www.php.net/ChangeLog-8.php#8.3.8

## 0x04   修复建议

### 通用修补建议

1、官方已发布安全更新，建议升级至最新版本。

2、若无法更新至新版本，且若 PHP 运行于 Window 平台上，建议关闭 php-cgi 的使用。
