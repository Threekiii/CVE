# Nacos 集群 Raft 反序列化漏洞通告

## 0x01  漏洞简述

Nacos在处理某些基于Jraft的请求时，采用Hessian进行反序列化，但并未设置限制，导致应用存在远程代码执行（RCE）漏洞。

**Nacos 1.x在单机模式下默认不开放7848端口**，故该情况通常不受此漏洞影响。然而，**2.x版本无论单机或集群模式均默认开放7848端口**。主要受影响的是7848端口的Jraft服务，因此，用户可据此判断自身可能的风险。

Nacos是一个易于使用的平台，专为动态服务发现和配置以及服务管理而设计。可以帮助您轻松构建云原生应用程序和微服务平台。

## 0x02  风险等级

漏洞的评定结果如下

| 评定方式    | 等级 |
| ----------- | ---- |
| 威胁等级    | 高危 |
| 影响面      | 广泛 |
| 攻击者价值  | 高   |
| 利用难度    | 低   |
| 360CERT评分 | 8.1  |

## 0x03  漏洞详情

### Nacos任意代码执行漏洞

组件: Nacos

漏洞类型: 不可信数据反序列化

实际影响: 任意代码执行

主要影响: 敏感数据窃取

简述: 该漏洞存在于Nacos中，是一个反序列化漏洞。Nacos的7848端口（默认配置，是Nacos集群间Raft协议的通信端口）在处理Raft请求时，攻击者可以无限制使用hessian进行反序列化利用，最终实现代码执行。

## 0x04  影响版本

```
1.4.0 <= Nacos < 1.4.6  使用cluster集群模式运行
2.0.0 <= Nacos < 2.2.3  任意模式启动均受到影响
```

## 0x05  修复建议

### 通用修补建议

目前官方已发布安全修复更新，受影响用户可以升级到Nacos 1.4.6、Nacos 2.2.3

- https://github.com/alibaba/nacos/releases/tag/1.4.6

- https://github.com/alibaba/nacos/releases/tag/2.2.3

### 临时修补建议

对外限制开放7848端口，一般使用时该端口为Nacos集群间Raft协议的通信端口，不承载客户端请求，因此老版本可以通过禁止该端口来自Nacos集群外的请求达到止血目的（如部署时已进行限制或未暴露，则风险可控）。